<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ê²Œì‹œë¬¼ ìë™í™” ë„êµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .post-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .post-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-content {
            flex: 1;
            margin-right: 15px;
        }

        .post-content h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .post-content p {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        .post-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-large {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .setting-card h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .logs {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .logs h3 {
            margin-bottom: 15px;
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .log-entry {
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .required {
            color: #e74c3c;
        }

        .help-text {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            font-size: 14px;
            color: #1565c0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .automation-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .automation-controls .btn {
            flex: 1;
        }

        /* ğŸ“¸ğŸ¬ ë¯¸ë””ì–´ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .media-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #667eea;
        }

        .media-upload-group {
            margin-bottom: 20px;
        }

        .media-upload-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .media-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .selected-media {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .media-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: white;
            border: 2px solid #e9ecef;
        }

        .media-item img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .media-item .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .media-item .remove-btn:hover {
            background: #ff3742;
            transform: scale(1.1);
        }

        .video-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border-radius: 8px;
            background: white;
            border: 1px solid #e9ecef;
        }

        .video-result-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .video-result-item:hover {
            background-color: #f8f9fa;
        }

        .video-result-item:last-child {
            border-bottom: none;
        }

        .video-result-item img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 12px;
        }

        .video-result-info {
            flex: 1;
        }

        .video-result-title {
            font-weight: bold;
            margin-bottom: 4px;
            color: #333;
            font-size: 14px;
        }

        .video-result-channel {
            font-size: 12px;
            color: #666;
        }

        .video-item {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #e9ecef;
        }

        .video-item img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }

        .video-item-info {
            flex: 1;
            font-size: 14px;
        }

        .video-item-title {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .video-item-channel {
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ YouTube ìë™í™” Pro</h1>
            <p>ì—¬ëŸ¬ ê²Œì‹œë¬¼ì„ ìˆœì°¨ì ìœ¼ë¡œ ìë™ ì‘ì„±í•´ë“œë¦½ë‹ˆë‹¤</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('accounts', event)">ğŸ‘¥ ê³„ì • ê´€ë¦¬</button>
            <button class="tab" onclick="switchTab('posts', event)">ğŸ“ ê²Œì‹œë¬¼</button>
            <button class="tab" onclick="switchTab('settings', event)">âš™ï¸ ì„¤ì •</button>
            <button class="tab" onclick="switchTab('automation', event)">ğŸš€ ì‹¤í–‰</button>
        </div>

        <!-- ê³„ì • ê´€ë¦¬ íƒ­ -->
        <div id="accounts" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">ğŸ‘¥ ê³„ì • ê´€ë¦¬</h3>
                <div id="accountCount" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    ğŸ’¾ ì €ì¥ëœ ê³„ì •: 0ê°œ
                </div>
            </div>

            <!-- ê³„ì • ì¶”ê°€ í¼ -->
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 15px;">â• ìƒˆ ê³„ì • ì¶”ê°€</h4>
                <form id="accountForm">
                    <div class="form-group">
                        <label for="accountName">ê³„ì •ëª… (ë³„ì¹­) <span class="required">*</span></label>
                        <input type="text" id="accountName" placeholder="ì˜ˆ: ë©”ì¸ ê³„ì •, ì„œë¸Œ ê³„ì •" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="accountUsername">YouTube ì•„ì´ë”” <span class="required">*</span></label>
                        <input type="text" id="accountUsername" placeholder="YouTube ê³„ì • ì•„ì´ë””" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="accountPassword">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                        <input type="password" id="accountPassword" placeholder="YouTube ê³„ì • ë¹„ë°€ë²ˆí˜¸" required>
                        <div class="help-text">
                            ğŸ’¡ <strong>2ì°¨ ì¸ì¦ ì‚¬ìš© ì‹œ:</strong> <a href="https://myaccount.google.com/apppasswords" target="_blank">Google ì•± ë¹„ë°€ë²ˆí˜¸</a> ì‚¬ìš© ê¶Œì¥
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="accountDescription">ì„¤ëª… (ì„ íƒì‚¬í•­)</label>
                        <textarea id="accountDescription" placeholder="ê³„ì •ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..." rows="3"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="btn btn-primary" onclick="addAccount()">
                            â• ê³„ì • ì¶”ê°€
                        </button>
                        <button id="cancelEditPostBtn" type="button" style="display:none;" onclick="cancelEditPost()">
                            âŒ ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>

            <!-- ê³„ì • ëª©ë¡ -->
            <div class="post-list" id="accountList">
                <p style="text-align: center; color: #666; font-style: italic;">
                    ì•„ì§ ë“±ë¡ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                    ìœ„ì—ì„œ ê³„ì •ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </p>
            </div>
        </div>

        <!-- ê²Œì‹œë¬¼ ê´€ë¦¬ íƒ­ -->
        <div id="posts" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">ğŸ“ ê²Œì‹œë¬¼ ê´€ë¦¬</h3>
                <div id="postCount" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    ğŸ’¾ ì €ì¥ëœ ê²Œì‹œë¬¼: 0ê°œ
                </div>
            </div>
            
            <div class="form-group">
                <label for="postAccount">ì‚¬ìš©í•  ê³„ì • ì„ íƒ <span class="required">*</span></label>
                <select id="postAccount" required>
                    <option value="">ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>

            <div class="form-group">
                <label for="newPostContent">ìƒˆ ê²Œì‹œë¬¼ ë‚´ìš© <span class="required">*</span></label>
                <textarea id="newPostContent" placeholder="ê²Œì‹œí•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>

            <!-- ğŸ“¸ğŸ¬ ë¯¸ë””ì–´ ì¶”ê°€ ì„¹ì…˜ -->
            <div class="media-section">
                <h4 style="margin-bottom: 15px;">ğŸ“¸ ë¯¸ë””ì–´ ì¶”ê°€</h4>
                
                <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                <div class="media-upload-group">
                    <label class="media-upload-btn" for="imageUpload">
                        ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„ íƒ
                        <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                    </label>
                    <div id="selectedImages" class="selected-media"></div>
                </div>

                <!-- ë™ì˜ìƒ ê²€ìƒ‰ -->
                <div class="media-upload-group">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="videoSearch" placeholder="YouTubeì—ì„œ ë™ì˜ìƒ ê²€ìƒ‰..." style="flex: 1;" onkeypress="if(event.key==='Enter') searchVideos()">
                        <button type="button" class="btn btn-secondary" onclick="searchVideos()">
                            ğŸ” ê²€ìƒ‰
                        </button>
                    </div>
                    <div id="videoResults" class="video-results"></div>
                    <div id="selectedVideos" class="selected-media"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button id="addPostBtn" type="button" onclick="addPost()">
                    â• ê²Œì‹œë¬¼ ì¶”ê°€
                </button>
                <button type="button" class="btn btn-secondary" onclick="clearAllPosts()">
                    ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                </button>
                <button type="button" class="btn btn-secondary" onclick="exportPosts()">
                    ğŸ’¾ ë‚´ë³´ë‚´ê¸°
                </button>
                <button type="button" class="btn btn-secondary" onclick="importPosts()">
                    ğŸ“ ê°€ì ¸ì˜¤ê¸°
                </button>
            </div>

            <div class="post-list" id="postList">
                <p style="text-align: center; color: #666; font-style: italic;">
                    ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                    ìœ„ì—ì„œ ê²Œì‹œë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </p>
            </div>
        </div>

        <!-- ìë™í™” ì„¤ì • íƒ­ -->
        <div id="settings" class="tab-content">
            <div class="settings-grid">
                <div class="setting-card">
                    <h3>ğŸ–¥ï¸ ë¸Œë¼ìš°ì € ì„¤ì •</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showBrowser" checked>
                        <label for="showBrowser">ë¸Œë¼ìš°ì € í™”ë©´ í‘œì‹œ</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="maximizeWindow" checked>
                        <label for="maximizeWindow">ë¸Œë¼ìš°ì € ìµœëŒ€í™”</label>
                    </div>
                    <div class="form-group">
                        <label for="browserSpeed">ë¸Œë¼ìš°ì € ì†ë„</label>
                        <select id="browserSpeed">
                            <option value="fast">ë¹ ë¦„ (ê¶Œì¥)</option>
                            <option value="normal">ë³´í†µ</option>
                            <option value="slow">ëŠë¦¼ (ì•ˆì •ì„± ìš°ì„ )</option>
                        </select>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>â±ï¸ ëŒ€ê¸° ì‹œê°„ ì„¤ì •</h3>
                    <div class="form-group">
                        <label for="postDelay">ê²Œì‹œë¬¼ ê°„ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                        <input type="number" id="postDelay" value="5" min="1" max="60">
                    </div>
                    <div class="form-group">
                        <label for="manualPostWait">ìˆ˜ë™ ê²Œì‹œ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                        <input type="number" id="manualPostWait" value="20" min="10" max="120">
                    </div>
                </div>

                <div class="setting-card">
                    <h3>ğŸ”„ ìë™í™” ì˜µì…˜</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoRetry" checked>
                        <label for="autoRetry">ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="skipOnError">
                        <label for="skipOnError">ì˜¤ë¥˜ ì‹œ ë‹¤ìŒ ê²Œì‹œë¬¼ë¡œ ê±´ë„ˆë›°ê¸°</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="closeOnComplete" checked>
                        <label for="closeOnComplete">ì™„ë£Œ í›„ ë¸Œë¼ìš°ì € ìë™ ì¢…ë£Œ</label>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>ğŸ“Š ë¡œê·¸ ì„¤ì •</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="detailedLogs" checked>
                        <label for="detailedLogs">ìƒì„¸ ë¡œê·¸ í‘œì‹œ</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="saveLogsToFile">
                        <label for="saveLogsToFile">ë¡œê·¸ íŒŒì¼ë¡œ ì €ì¥</label>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-primary btn-large" onclick="saveSettings()">
                ğŸ’¾ ì„¤ì • ì €ì¥
            </button>
        </div>

        <!-- ìë™í™” ì‹¤í–‰ íƒ­ -->
        <div id="automation" class="tab-content">
            <div class="status" id="automationStatus">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="statusText">ìë™í™” ì¤€ë¹„ ì™„ë£Œ</p>
            </div>

            <div class="automation-controls">
                <button type="button" class="btn btn-success btn-large" id="startAutomation" onclick="startAutomation()">
                    ğŸš€ ìë™í™” ì‹œì‘
                </button>
                <button type="button" class="btn btn-danger btn-large" id="stopAutomation" onclick="stopAutomation()" disabled>
                    â¹ï¸ ìë™í™” ì¤‘ì§€
                </button>
                <button type="button" class="btn btn-secondary btn-large" onclick="resetAutomation()">
                    ğŸ”„ ì´ˆê¸°í™”
                </button>
            </div>

            <div class="logs" id="automationLogs">
                <h3>ğŸ“‹ ìë™í™” ë¡œê·¸</h3>
                <div id="logEntries">
                    <div class="log-entry">ìë™í™” ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editPostModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ ê²Œì‹œë¬¼ ìˆ˜ì •</h3>
                <button class="close-btn" onclick="closeEditPostModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editPostForm">
                    <div class="form-group">
                        <label for="editPostAccount">ì‚¬ìš©í•  ê³„ì • ì„ íƒ <span class="required">*</span></label>
                        <select id="editPostAccount" required>
                            <option value="">ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editPostContent">ê²Œì‹œë¬¼ ë‚´ìš© <span class="required">*</span></label>
                        <textarea id="editPostContent" placeholder="ê²Œì‹œí•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." rows="6" required></textarea>
                    </div>

                    <!-- ê¸°ì¡´ ì´ë¯¸ì§€ -->
                    <div class="form-group" id="editImagesSection">
                        <label>ğŸ“¸ ê¸°ì¡´ ì´ë¯¸ì§€</label>
                        <div id="editExistingImages" class="selected-media"></div>
                    </div>

                    <!-- ìƒˆ ì´ë¯¸ì§€ ì¶”ê°€ -->
                    <div class="form-group">
                        <label class="media-upload-btn" for="editImageUpload">
                            ğŸ–¼ï¸ ìƒˆ ì´ë¯¸ì§€ ì¶”ê°€
                            <input type="file" id="editImageUpload" accept="image/*" multiple style="display: none;" onchange="handleEditImageUpload(event)">
                        </label>
                        <div id="editNewImages" class="selected-media"></div>
                    </div>

                    <!-- ê¸°ì¡´ ë™ì˜ìƒ -->
                    <div class="form-group" id="editVideosSection">
                        <label>ğŸ¬ ê¸°ì¡´ ë™ì˜ìƒ</label>
                        <div id="editExistingVideos" class="selected-media"></div>
                    </div>

                    <!-- ìƒˆ ë™ì˜ìƒ ê²€ìƒ‰ -->
                    <div class="form-group">
                        <label>ğŸ¬ ìƒˆ ë™ì˜ìƒ ì¶”ê°€</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="editVideoSearch" placeholder="YouTubeì—ì„œ ë™ì˜ìƒ ê²€ìƒ‰..." style="flex: 1;" onkeypress="if(event.key==='Enter') searchEditVideos()">
                            <button type="button" class="btn btn-secondary" onclick="searchEditVideos()">
                                ğŸ” ê²€ìƒ‰
                            </button>
                        </div>
                        <div id="editVideoResults" class="video-results"></div>
                        <div id="editNewVideos" class="selected-media"></div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-primary" onclick="saveEditedPost()">
                            ğŸ’¾ ìˆ˜ì • ì™„ë£Œ
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditPostModal()">
                            âŒ ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
       
        // ì „ì—­ ë³€ìˆ˜
        let posts = [];
        let accounts = [];
        let currentPostIndex = 0;
        let isAutomationRunning = false;
        let automationSocket = null;
        let selectedImages = [];
        let selectedVideos = [];
        let editingAccountId = null;
        let editingPostId = null;
        let editNewImages = [];
        let editNewVideos = [];

        // íƒ­ ì „í™˜
        function switchTab(tabName, event) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            if (event) event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        window.switchTab = switchTab;

        // ğŸ“¸ğŸ¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ (multer + multipart/form-data)
        async function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            for (const file of files) {
                if (file.type.startsWith('image/')) {
                    const formData = new FormData();
                    formData.append('image', file);
                    try {
                        const res = await fetch('/api/upload-image', {
                            method: 'POST',
                            body: formData
                        });
                        const data = await res.json();
                        if (data.success && data.url) {
                            selectedImages.push({ url: data.url, name: file.name, type: 'image' });
                            updateSelectedImages();
                        } else {
                            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì„œë²„ ì˜¤ë¥˜'));
                        }
                    } catch (err) {
                        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
                    }
                }
            }
        }

        // ğŸ“¸ ì„ íƒëœ ì´ë¯¸ì§€ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedImages() {
            const container = document.getElementById('selectedImages');
            if (selectedImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            container.innerHTML = selectedImages.map(img => `
                <div class="media-item">
                    <img src="${img.url}" alt="${img.name}">
                    <button class="remove-btn" onclick="removeImage('${img.url}')">Ã—</button>
                </div>
            `).join('');
        }

        // ğŸ“¸ ì´ë¯¸ì§€ ì œê±°
        function removeImage(imageUrl) {
            selectedImages = selectedImages.filter(img => img.url !== imageUrl);
            updateSelectedImages();
        }

        // ğŸ¬ YouTube ë™ì˜ìƒ ê²€ìƒ‰ (ì•±ìš© - í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì²˜ë¦¬)
        async function searchVideos() {
            const query = document.getElementById('videoSearch').value.trim();
            if (!query) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const resultsContainer = document.getElementById('videoResults');
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px;">ğŸ” ê²€ìƒ‰ ì¤‘...</div>';
            try {
                // ì„œë²„ APIë¡œ ì‹¤ì œ ê²€ìƒ‰
                const res = await fetch(`/api/search-videos?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                if (data.success && Array.isArray(data.videos)) {
                    displayVideoResults(data.videos);
                } else {
                    resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff4757;">âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff4757;">âŒ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Video search error:', error);
            }
        }

        // ğŸ¬ ë™ì˜ìƒ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displayVideoResults(videos) {
            const container = document.getElementById('videoResults');
            
            if (videos.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = videos.map(video => `
                <div class="video-result-item" onclick="selectVideo('${video.id}', '${video.title}', '${video.channel}', '${video.thumbnail}')">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div class="video-result-info">
                        <div class="video-result-title">${video.title}</div>
                        <div class="video-result-channel">${video.channel}</div>
                    </div>
                </div>
            `).join('');
        }

        // ğŸ¬ ë™ì˜ìƒ ì„ íƒ
        function selectVideo(videoId, title, channel, thumbnail) {
            const videoData = {
                id: videoId,
                title: title,
                channel: channel,
                thumbnail: thumbnail,
                url: `https://www.youtube.com/watch?v=${videoId}`
            };
            
            // ì¤‘ë³µ ì„ íƒ ë°©ì§€
            if (!selectedVideos.find(v => v.id === videoId)) {
                selectedVideos.push(videoData);
                updateSelectedVideos();
                
                // ê²€ìƒ‰ ê²°ê³¼ ìˆ¨ê¸°ê¸°
                document.getElementById('videoResults').innerHTML = '';
                document.getElementById('videoSearch').value = '';
            }
        }

        // ğŸ¬ ì„ íƒëœ ë™ì˜ìƒ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedVideos() {
            const container = document.getElementById('selectedVideos');
            
            if (selectedVideos.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = selectedVideos.map(video => `
                <div class="video-item">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div class="video-item-info">
                        <div class="video-item-title">${video.title}</div>
                        <div class="video-item-channel">${video.channel}</div>
                    </div>
                    <button class="remove-btn" onclick="removeVideo('${video.id}')">Ã—</button>
                </div>
            `).join('');
        }

        // ğŸ¬ ë™ì˜ìƒ ì œê±°
        function removeVideo(videoId) {
            selectedVideos = selectedVideos.filter(video => video.id !== videoId);
            updateSelectedVideos();
        }

        // ê²Œì‹œë¬¼ ì¶”ê°€ (ì´ë¯¸ì§€ëŠ” urlë§Œ í¬í•¨)
        async function addPost() {
            const content = document.getElementById('newPostContent').value.trim();
            const accountId = document.getElementById('postAccount').value;
            if (!content) {
                alert('ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            if (!accountId) {
                alert('ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            const account = accounts.find(acc => acc.id === accountId);
            const images = selectedImages.map(img => ({ url: img.url, name: img.name, type: 'image' }));
            const videos = [...selectedVideos];
            const postData = {
                content,
                accountId,
                username: account ? account.username : '',
                password: account ? account.password : '',
                images,
                videos,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            const res = await fetch('/api/posts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(postData)
            });
            const result = await res.json();
            if (result.success) {
                alert('ê²Œì‹œë¬¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadAllAndUpdatePosts();
                document.getElementById('newPostContent').value = '';
                document.getElementById('postAccount').selectedIndex = 0;
                selectedImages = [];
                selectedVideos = [];
                updateSelectedImages();
                updateSelectedVideos();
            } else {
                alert('ê²Œì‹œë¬¼ ì¶”ê°€ ì‹¤íŒ¨');
            }
        }

        // ê²Œì‹œë¬¼ ëª©ë¡ ì—…ë°ì´íŠ¸ (ğŸ’¾ ê°œìˆ˜ í‘œì‹œ í¬í•¨)
        function updatePostList() {
            const postList = document.getElementById('postList');
            const postCount = document.getElementById('postCount');
            
            // ğŸ’¾ ê²Œì‹œë¬¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            const completedCount = posts.filter(p => p.status === 'completed').length;
            const failedCount = posts.filter(p => p.status === 'failed').length;
            const pendingCount = posts.filter(p => p.status === 'pending').length;
            
            postCount.innerHTML = `ğŸ’¾ ì €ì¥ëœ ê²Œì‹œë¬¼: ${posts.length}ê°œ 
                ${completedCount > 0 ? `(âœ…${completedCount}` : ''}
                ${failedCount > 0 ? ` âŒ${failedCount}` : ''}
                ${pendingCount > 0 ? ` â³${pendingCount}` : ''}
                ${completedCount > 0 || failedCount > 0 || pendingCount > 0 ? ')' : ''}`;
            
            if (posts.length === 0) {
                postList.innerHTML = `
                    <p style="text-align: center; color: #666; font-style: italic;">
                        ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ìœ„ì—ì„œ ê²Œì‹œë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                    </p>
                `;
                return;
            }
            
            postList.innerHTML = posts.map((post, index) => {
                const imageCount = post.images ? post.images.length : 0;
                const videoCount = post.videos ? post.videos.length : 0;
                const mediaInfo = [];
                
                if (imageCount > 0) mediaInfo.push(`ğŸ“¸ ${imageCount}ê°œ`);
                if (videoCount > 0) mediaInfo.push(`ğŸ¬ ${videoCount}ê°œ`);
                
                return `
                <div class="post-item">
                    <div class="post-content">
                        <h4>ê²Œì‹œë¬¼ ${index + 1} ${mediaInfo.length > 0 ? `(${mediaInfo.join(', ')})` : ''}</h4>
                        <p>${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</p>
                        <small>ìƒíƒœ: ${getStatusText(post.status)}</small>
                        ${post.account ? `<div style="margin-top: 4px; color: #28a745; font-size: 12px;">ğŸ‘¤ ê³„ì •: ${post.account.name} (${post.account.username})</div>` : ''}
                        ${mediaInfo.length > 0 ? `<div style="margin-top: 8px; color: #667eea; font-size: 12px;">ğŸ“ ë¯¸ë””ì–´: ${mediaInfo.join(', ')}</div>` : ''}
                    </div>
                    <div class="post-actions">
                        ${post.status === 'pending' || post.status === 'failed' ? 
                            `<button class="btn btn-secondary" onclick="editPost('${post.id}')">ìˆ˜ì •</button>` : 
                            `<button class="btn btn-secondary" disabled title="ì™„ë£Œ ë˜ëŠ” ì²˜ë¦¬ì¤‘ì¸ ê²Œì‹œë¬¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">ìˆ˜ì •</button>`
                        }
                        <button class="btn btn-danger" onclick="deletePost('${post.id}')">ì‚­ì œ</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            const statusMap = {
                'pending': 'ëŒ€ê¸° ì¤‘',
                'processing': 'ì²˜ë¦¬ ì¤‘',
                'completed': 'ì™„ë£Œ',
                'failed': 'ì‹¤íŒ¨'
            };
            return statusMap[status] || status;
        }

        // ê²Œì‹œë¬¼ ì‚­ì œ (API ì—°ë™)
        async function deletePost(postId) {
            if (!confirm('ì´ ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const res = await fetch(`/api/posts/${postId}`, { method: 'DELETE' });
            const result = await res.json();
            if (result.success) {
                alert('ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadAllAndUpdatePosts();
            } else {
                alert('ê²Œì‹œë¬¼ ì‚­ì œ ì‹¤íŒ¨');
            }
        }

        // ê²Œì‹œë¬¼ ìˆ˜ì • (ğŸ’¾ ì €ì¥ ê¸°ëŠ¥ ì¶”ê°€)
        function editPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) {
                alert('ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (post.status === 'completed' || post.status === 'processing') {
                alert('ì™„ë£Œë˜ì—ˆê±°ë‚˜ ì²˜ë¦¬ì¤‘ì¸ ê²Œì‹œë¬¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            openEditPostModal(post);
        }

        // ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function openEditPostModal(post) {
            console.log(document.getElementById('editPostContent'))
            editingPostId = post.id; // â† ì´ ì¤„ì´ ë°˜ë“œì‹œ í•„ìš”!
            // ê³„ì • ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            updateEditAccountDropdown();
            
            // ê¸°ì¡´ ë°ì´í„° ì„¤ì •
            document.getElementById('editPostContent').value = post.content;
            
            // ê³„ì • ì„ íƒ
            if (post.account) {
                document.getElementById('editPostAccount').value = post.account.id;
            }
            
            // ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ
            displayEditExistingImages(post.images || []);
            
            // ê¸°ì¡´ ë™ì˜ìƒ í‘œì‹œ
            displayEditExistingVideos(post.videos || []);
            
            // ìƒˆë¡œ ì¶”ê°€í•  ë¯¸ë””ì–´ ì´ˆê¸°í™”
            editNewImages = [];
            editNewVideos = [];
            updateEditNewImages();
            updateEditNewVideos();
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('editPostModal').style.display = 'flex';
        }

        // ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditPostModal() {
            document.getElementById('editPostModal').style.display = 'none';
            editingPostId = null;
            editNewImages = [];
            editNewVideos = [];
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('editPostForm').reset();
            document.getElementById('editExistingImages').innerHTML = '';
            document.getElementById('editExistingVideos').innerHTML = '';
            document.getElementById('editNewImages').innerHTML = '';
            document.getElementById('editNewVideos').innerHTML = '';
            document.getElementById('editVideoResults').innerHTML = '';
        }

        // ìˆ˜ì •ìš© ê³„ì • ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateEditAccountDropdown() {
            const editPostAccount = document.getElementById('editPostAccount');
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
            while (editPostAccount.children.length > 1) {
                editPostAccount.removeChild(editPostAccount.lastChild);
            }

            // ê³„ì • ì˜µì…˜ ì¶”ê°€
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = `${account.name} (${account.username})`;
                editPostAccount.appendChild(option);
            });

            // âŒ updateEditAccountDropdown();  // ì´ ì¤„ì„ ë°˜ë“œì‹œ ì‚­ì œ!
        }

        // ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ
        function displayEditExistingImages(images) {
            const container = document.getElementById('editExistingImages');
            
            if (images.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">ë“±ë¡ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = images.map((img, index) => `
                <div class="media-item">
                    <img src="${img.data}" alt="${img.name}">
                    <div class="media-item-info">
                        <div class="media-item-title">${img.name}</div>
                    </div>
                    <button class="remove-btn" onclick="removeEditExistingImage(${index})" title="ì´ë¯¸ì§€ ì‚­ì œ">Ã—</button>
                </div>
            `).join('');
        }

        // ê¸°ì¡´ ë™ì˜ìƒ í‘œì‹œ
        function displayEditExistingVideos(videos) {
            const container = document.getElementById('editExistingVideos');
            
            if (videos.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">ë“±ë¡ëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = videos.map((video, index) => `
                <div class="video-item">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div class="video-item-info">
                        <div class="video-item-title">${video.title}</div>
                        <div class="video-item-channel">${video.channel}</div>
                    </div>
                    <button class="remove-btn" onclick="removeEditExistingVideo(${index})" title="ë™ì˜ìƒ ì‚­ì œ">Ã—</button>
                </div>
            `).join('');
        }

        // ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ
        function removeEditExistingImage(index) {
            const post = posts.find(p => p.id === editingPostId);
            if (post && post.images) {
                post.images.splice(index, 1);
                displayEditExistingImages(post.images);
            }
        }

        // ê¸°ì¡´ ë™ì˜ìƒ ì‚­ì œ
        function removeEditExistingVideo(index) {
            const post = posts.find(p => p.id === editingPostId);
            if (post && post.videos) {
                post.videos.splice(index, 1);
                displayEditExistingVideos(post.videos);
            }
        }

        // ìˆ˜ì •ìš© ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleEditImageUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            type: 'image',
                            data: e.target.result,
                            file: file
                        };
                        
                        editNewImages.push(imageData);
                        updateEditNewImages();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ìˆ˜ì •ìš© ìƒˆ ì´ë¯¸ì§€ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateEditNewImages() {
            const container = document.getElementById('editNewImages');
            
            if (editNewImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = editNewImages.map(img => `
                <div class="media-item">
                    <img src="${img.data}" alt="${img.name}">
                    <div class="media-item-info">
                        <div class="media-item-title">${img.name}</div>
                    </div>
                    <button class="remove-btn" onclick="removeEditNewImage('${img.id}')">Ã—</button>
                </div>
            `).join('');
        }

        // ìˆ˜ì •ìš© ìƒˆ ì´ë¯¸ì§€ ì œê±°
        function removeEditNewImage(imageId) {
            editNewImages = editNewImages.filter(img => img.id !== imageId);
            updateEditNewImages();
        }

        // ìˆ˜ì •ìš© ë™ì˜ìƒ ê²€ìƒ‰
        async function searchEditVideos() {
            const query = document.getElementById('editVideoSearch').value.trim();
            if (!query) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const resultsContainer = document.getElementById('editVideoResults');
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px;">ğŸ” ê²€ìƒ‰ ì¤‘...</div>';
            try {
                // ì„œë²„ APIë¡œ ì‹¤ì œ ê²€ìƒ‰
                const res = await fetch(`/api/search-videos?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                if (data.success && Array.isArray(data.videos)) {
                    displayEditVideoResults(data.videos);
                } else {
                    resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff4757;">âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff4757;">âŒ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Video search error:', error);
            }
        }

        // ìˆ˜ì •ìš© ë™ì˜ìƒ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displayEditVideoResults(videos) {
            const container = document.getElementById('editVideoResults');
            
            if (videos.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            container.innerHTML = videos.map(video => `
                <div class="video-result-item" onclick="selectEditVideo('${video.id}', '${video.title}', '${video.channel}', '${video.thumbnail}')">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div class="video-result-info">
                        <div class="video-result-title">${video.title}</div>
                        <div class="video-result-channel">${video.channel}</div>
                    </div>
                </div>
            `).join('');
        }

        // ìˆ˜ì •ìš© ë™ì˜ìƒ ì„ íƒ
        function selectEditVideo(videoId, title, channel, thumbnail) {
            const videoData = {
                id: videoId,
                title: title,
                channel: channel,
                thumbnail: thumbnail,
                url: `https://www.youtube.com/watch?v=${videoId}`
            };
            
            // ì¤‘ë³µ ì„ íƒ ë°©ì§€
            if (!editNewVideos.find(v => v.id === videoId)) {
                editNewVideos.push(videoData);
                updateEditNewVideos();
                
                // ê²€ìƒ‰ ê²°ê³¼ ìˆ¨ê¸°ê¸°
                document.getElementById('editVideoResults').innerHTML = '';
                document.getElementById('editVideoSearch').value = '';
            }
        }

        // ìˆ˜ì •ìš© ìƒˆ ë™ì˜ìƒ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateEditNewVideos() {
            const container = document.getElementById('editNewVideos');
            
            if (editNewVideos.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = editNewVideos.map(video => `
                <div class="video-item">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div class="video-item-info">
                        <div class="video-item-title">${video.title}</div>
                        <div class="video-item-channel">${video.channel}</div>
                    </div>
                    <button class="remove-btn" onclick="removeEditNewVideo('${video.id}')">Ã—</button>
                </div>
            `).join('');
        }

        // ìˆ˜ì •ìš© ìƒˆ ë™ì˜ìƒ ì œê±°
        function removeEditNewVideo(videoId) {
            editNewVideos = editNewVideos.filter(video => video.id !== videoId);
            updateEditNewVideos();
        }

        // ìˆ˜ì •ëœ ê²Œì‹œë¬¼ ì €ì¥
        async function saveEditedPost() {
            console.log('editingPostId:', editingPostId);
            console.log('posts:', posts.map(p => p.id));
            alert('saveEditedPost called, editingPostId=' + editingPostId);
            const content = document.getElementById('editPostContent').value.trim();
            const selectedAccountId = document.getElementById('editPostAccount').value;
            if (!content) {
                alert('ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!selectedAccountId) {
                alert('ì‚¬ìš©í•  ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            const selectedAccount = accounts.find(acc => acc.id === selectedAccountId);
            if (!selectedAccount) {
                alert('ì„ íƒëœ ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            const post = posts.find(p => p.id === editingPostId);
            if (!post) {
                alert('ìˆ˜ì •í•  ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            // ìƒíƒœ ì²´í¬ ì¶”ê°€
            if (post.status === 'completed' || post.status === 'processing') {
                alert('ì™„ë£Œë˜ì—ˆê±°ë‚˜ ì²˜ë¦¬ì¤‘ì¸ ê²Œì‹œë¬¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                closeEditPostModal();
                return;
            }
            // ê¸°ì¡´+ìƒˆ ì´ë¯¸ì§€/ë™ì˜ìƒ í•©ì¹˜ê¸°
            let images = (post.images || []).concat(editNewImages);
            let videos = (post.videos || []).concat(editNewVideos);
            // ì„œë²„ì— PUT ìš”ì²­
            const res = await fetch(`/api/posts/${editingPostId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    content,
                    accountId: selectedAccountId,
                    images,
                    videos
                })
            });
            const result = await res.json();
            if (result.success) {
                alert('ê²Œì‹œë¬¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadAllAndUpdatePosts();
                closeEditPostModal();
            } else {
                alert('ê²Œì‹œë¬¼ ìˆ˜ì • ì‹¤íŒ¨');
            }
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            const settings = {
                showBrowser: document.getElementById('showBrowser').checked,
                maximizeWindow: document.getElementById('maximizeWindow').checked,
                browserSpeed: document.getElementById('browserSpeed').value,
                postDelay: parseInt(document.getElementById('postDelay').value),
                manualPostWait: parseInt(document.getElementById('manualPostWait').value),
                autoRetry: document.getElementById('autoRetry').checked,
                skipOnError: document.getElementById('skipOnError').checked,
                closeOnComplete: document.getElementById('closeOnComplete').checked,
                detailedLogs: document.getElementById('detailedLogs').checked,
                saveLogsToFile: document.getElementById('saveLogsToFile').checked
            };
            // localStorage.setItem('automation_settings', JSON.stringify(settings)); // ì‚­ì œ
            showStatus('success', 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ìë™í™” ì‹œì‘
        function startAutomation() {
            if (posts.length === 0) {
                alert('ë¨¼ì € ê²Œì‹œë¬¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                return;
            }
            // ì²˜ë¦¬í•  ê²Œì‹œë¬¼ í•„í„°ë§ (ì™„ë£Œë˜ì§€ ì•Šì€ ê²Œì‹œë¬¼ë§Œ)
            const pendingPosts = posts.filter(post => post.status !== 'completed');
            if (pendingPosts.length === 0) {
                alert('ì²˜ë¦¬í•  ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.\nëª¨ë“  ê²Œì‹œë¬¼ì´ ì´ë¯¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            // ê° postì— accountë¥¼ ë™ì ìœ¼ë¡œ ë§¤í•‘
            pendingPosts.forEach(post => {
                post.account = accounts.find(acc => acc.id === post.accountId) || null;
            });
            // ê³„ì •ì´ ì„¤ì •ë˜ì§€ ì•Šì€ ê²Œì‹œë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸ (ì™„ë£Œë˜ì§€ ì•Šì€ ê²Œì‹œë¬¼ ì¤‘ì—ì„œ)
            const postsWithoutAccount = pendingPosts.filter(post => !post.account);
            if (postsWithoutAccount.length > 0) {
                alert(`${postsWithoutAccount.length}ê°œì˜ ê²Œì‹œë¬¼ì— ê³„ì •ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nê³„ì • ê´€ë¦¬ íƒ­ì—ì„œ ê³„ì •ì„ ì¶”ê°€í•˜ê³  ê²Œì‹œë¬¼ì— ê³„ì •ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.`);
                switchTab('accounts');
                return;
            }
            
            // ì²˜ë¦¬í•  ê²Œì‹œë¬¼ ê°œìˆ˜ ì•Œë¦¼
            const completedCount = posts.filter(post => post.status === 'completed').length;
            if (completedCount > 0) {
                addLog(`ğŸ“‹ ì´ ${posts.length}ê°œ ê²Œì‹œë¬¼ ì¤‘ ${completedCount}ê°œëŠ” ì´ë¯¸ ì™„ë£Œë˜ì–´ ê±´ë„ˆëœë‹ˆë‹¤.`);
                addLog(`ğŸ¯ ${pendingPosts.length}ê°œ ê²Œì‹œë¬¼ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.`);
            }
            
            isAutomationRunning = true;
            currentPostIndex = 0;
            
            document.getElementById('startAutomation').disabled = true;
            document.getElementById('stopAutomation').disabled = false;
            
            showStatus('info', 'ìë™í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
            addLog('ğŸš€ ìë™í™” ì‹œì‘');
            
            processNextPost();
        }

        // ë‹¤ìŒ ê²Œì‹œë¬¼ ì²˜ë¦¬
        function processNextPost() {
            if (!isAutomationRunning) {
                completeAutomation();
                return;
            }
            
            // ì™„ë£Œë˜ì§€ ì•Šì€ ë‹¤ìŒ ê²Œì‹œë¬¼ ì°¾ê¸°
            while (currentPostIndex < posts.length) {
                const post = posts[currentPostIndex];
                
                // ì´ë¯¸ ì™„ë£Œëœ ê²Œì‹œë¬¼ì€ ê±´ë„ˆë›°ê¸°
                if (post.status === 'completed') {
                    addLog(`âœ… ê²Œì‹œë¬¼ ${currentPostIndex + 1}ì€ ì´ë¯¸ ì™„ë£Œë˜ì–´ ê±´ë„ˆëœë‹ˆë‹¤.`);
                    currentPostIndex++;
                    continue;
                }
                
                // ì²˜ë¦¬í•  ê²Œì‹œë¬¼ ë°œê²¬
                post.status = 'processing';
                updatePostList();
                break;
            }
            
            // ëª¨ë“  ê²Œì‹œë¬¼ ì²˜ë¦¬ ì™„ë£Œ
            if (currentPostIndex >= posts.length) {
                completeAutomation();
                return;
            }
            
            const post = posts[currentPostIndex];
            
            // ì‹¤ì œ ì²˜ë¦¬í•  ê²Œì‹œë¬¼ ê°œìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰ë¥  ê³„ì‚°
            const totalPendingPosts = posts.filter(p => p.status !== 'completed').length;
            const processedPosts = posts.slice(0, currentPostIndex + 1).filter(p => p.status === 'processing' || p.status === 'completed').length;
            const progress = (processedPosts / Math.max(totalPendingPosts, 1)) * 100;
            
            updateProgress(progress, `ê²Œì‹œë¬¼ ${currentPostIndex + 1}/${posts.length} ì²˜ë¦¬ ì¤‘... (ì²˜ë¦¬ ëŒ€ìƒ: ${totalPendingPosts}ê°œ)`);
            
            addLog(`ğŸ“ ê²Œì‹œë¬¼ ${currentPostIndex + 1} ì²˜ë¦¬ ì‹œì‘`);
            
            // ì‹¤ì œ ìë™í™” ì‹¤í–‰ (ğŸ“¸ğŸ¬ ë¯¸ë””ì–´ í¬í•¨)
            const settings = JSON.parse(localStorage.getItem('automation_settings') || '{}');
            const imageCount = post.images ? post.images.length : 0;
            const videoCount = post.videos ? post.videos.length : 0;
            
            addLog(`ğŸ“¸ ì´ë¯¸ì§€ ${imageCount}ê°œ, ğŸ¬ ë™ì˜ìƒ ${videoCount}ê°œ í¬í•¨`);
            addLog(`ğŸš€ ì‹¤ì œ ìë™í™” ì‹œì‘ - Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘...`);
            
            // ì‹¤ì œ ìë™í™” API í˜¸ì¶œ (ë‹¨ì¼ ê²Œì‹œë¬¼ API ì‚¬ìš©)
            const automationData = {
                username: post.account ? post.account.username : localStorage.getItem('youtube_username'),
                password: post.account ? post.account.password : localStorage.getItem('youtube_password'),
                postContent: post.content,
                images: post.images || [],
                videos: post.videos || [],
                settings: settings,
                postIndex: currentPostIndex,
                // ê³„ì • ì •ë³´ ì¶”ê°€ (ë‹¤ì¤‘ ê³„ì • ì§€ì›)
                accountUsername: post.accountUsername || '',
                accountPassword: post.accountPassword || ''
            };

            // ğŸ”§ ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜ - ì§ë ¬í™” ë¶ˆê°€ëŠ¥í•œ ê°ì²´ë¥¼ ì•ˆì „í•œ í˜•íƒœë¡œ ë³€í™˜
            function sanitizeAutomationData(data) {
                const result = { ...data };
                
                // ì´ë¯¸ì§€ ë°ì´í„° ì •ë¦¬
                if (result.images && Array.isArray(result.images)) {
                    result.images = result.images.map((img, idx) => {
                        console.log(`ğŸ”§ ì´ë¯¸ì§€ ${idx} ì •ë¦¬ ì¤‘:`, typeof img, img?.constructor?.name);
                        
                        if (img instanceof File) {
                            console.warn(`âš ï¸ File ê°ì²´ ë°œê²¬ - ì œê±°ë¨`);
                            return null;
                        } else if (img instanceof Blob) {
                            console.warn(`âš ï¸ Blob ê°ì²´ ë°œê²¬ - ì œê±°ë¨`);
                            return null;
                        } else if (img && typeof img === 'object') {
                            // ì¼ë°˜ ê°ì²´ì¸ ê²½ìš° data ì†ì„±ë§Œ ìœ ì§€
                            const cleaned = {};
                            Object.keys(img).forEach(key => {
                                const value = img[key];
                                if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
                                    cleaned[key] = value;
                                } else if (value instanceof File || value instanceof Blob) {
                                    console.warn(`âš ï¸ ${key}ì— File/Blob ê°ì²´ ë°œê²¬ - ì œê±°ë¨`);
                                } else {
                                    try {
                                        JSON.stringify(value);
                                        cleaned[key] = value;
                                    } catch (e) {
                                        console.warn(`âš ï¸ ${key} ì§ë ¬í™” ë¶ˆê°€ëŠ¥ - ì œê±°ë¨`);
                                    }
                                }
                            });
                            return cleaned;
                        }
                        return img;
                    }).filter(img => img !== null);
                }
                
                // ë™ì˜ìƒ ë°ì´í„° ì •ë¦¬
                if (result.videos && Array.isArray(result.videos)) {
                    result.videos = result.videos.map(vid => {
                        if (vid instanceof File || vid instanceof Blob) {
                            console.warn(`âš ï¸ ë™ì˜ìƒì— File/Blob ê°ì²´ ë°œê²¬ - ì œê±°ë¨`);
                            return null;
                        }
                        return vid;
                    }).filter(vid => vid !== null);
                }
                
                // ìµœì¢… ì§ë ¬í™” í…ŒìŠ¤íŠ¸
                try {
                    JSON.stringify(result);
                    console.log('âœ… ë°ì´í„° ì •ë¦¬ ì™„ë£Œ - ì§ë ¬í™” ê°€ëŠ¥');
                } catch (e) {
                    console.error('âŒ ë°ì´í„° ì •ë¦¬ í›„ì—ë„ ì§ë ¬í™” ë¶ˆê°€ëŠ¥:', e);
                }
                
                return result;
            }

            // ğŸ” ë””ë²„ê¹…: ë°ì´í„° íƒ€ì… ë° ì§ë ¬í™” ê²€ì‚¬
            console.log('ğŸš€ ìë™í™” ë°ì´í„° ì „ì†¡ - ë””ë²„ê¹… ì‹œì‘');
            console.log('ğŸ“Š ë°ì´í„° íƒ€ì… ê²€ì‚¬:');
            console.log('- username type:', typeof automationData.username, 'value:', automationData.username);
            console.log('- password type:', typeof automationData.password, 'length:', automationData.password?.length);
            console.log('- postContent type:', typeof automationData.postContent, 'length:', automationData.postContent?.length);
            console.log('- images type:', typeof automationData.images, 'length:', automationData.images?.length);
            console.log('- videos type:', typeof automationData.videos, 'length:', automationData.videos?.length);
            console.log('- settings type:', typeof automationData.settings, 'value:', automationData.settings);
            console.log('- postIndex type:', typeof automationData.postIndex, 'value:', automationData.postIndex);
            
            // ì´ë¯¸ì§€ ë°ì´í„° ìƒì„¸ ê²€ì‚¬
            if (automationData.images && automationData.images.length > 0) {
                console.log('ğŸ“¸ ì´ë¯¸ì§€ ë°ì´í„° ìƒì„¸:');
                automationData.images.forEach((img, idx) => {
                    console.log(`  ì´ë¯¸ì§€ ${idx}:`, {
                        type: typeof img,
                        hasData: img && 'data' in img,
                        dataType: img?.data ? typeof img.data : 'none',
                        dataLength: img?.data ? img.data.length : 0,
                        keys: img ? Object.keys(img) : [],
                        isFile: img instanceof File,
                        isBlob: img instanceof Blob
                    });
                });
            }
            
            // ë™ì˜ìƒ ë°ì´í„° ìƒì„¸ ê²€ì‚¬
            if (automationData.videos && automationData.videos.length > 0) {
                console.log('ğŸ¬ ë™ì˜ìƒ ë°ì´í„° ìƒì„¸:');
                automationData.videos.forEach((vid, idx) => {
                    console.log(`  ë™ì˜ìƒ ${idx}:`, {
                        type: typeof vid,
                        hasUrl: vid && 'url' in vid,
                        urlType: vid?.url ? typeof vid.url : 'none',
                        keys: vid ? Object.keys(vid) : [],
                        isFile: vid instanceof File,
                        isBlob: vid instanceof Blob
                    });
                });
            }
            
            // JSON ì§ë ¬í™” í…ŒìŠ¤íŠ¸
            try {
                const testSerialization = JSON.stringify(automationData);
                console.log('âœ… JSON ì§ë ¬í™” ì„±ê³µ, í¬ê¸°:', testSerialization.length);
            } catch (serError) {
                console.error('âŒ JSON ì§ë ¬í™” ì‹¤íŒ¨:', serError);
                console.log('ğŸ” ì§ë ¬í™” ì‹¤íŒ¨ ì›ì¸ ë¶„ì„...');
                
                // ê° ì†ì„±ë³„ë¡œ ì§ë ¬í™” í…ŒìŠ¤íŠ¸
                Object.keys(automationData).forEach(key => {
                    try {
                        JSON.stringify(automationData[key]);
                        console.log(`âœ… ${key}: ì§ë ¬í™” ê°€ëŠ¥`);
                    } catch (err) {
                        console.error(`âŒ ${key}: ì§ë ¬í™” ë¶ˆê°€ëŠ¥`, err);
                    }
                });
            }
            
            // Electronì˜ ipcRendererë¥¼ í†µí•´ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì— ìš”ì²­
            let automationPromise;
            
            // í•­ìƒ fetchë¡œ ì„œë²„ API í˜¸ì¶œ (ì›¹/Electron í†µì¼)
            automationPromise = fetch('/api/automate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(automationData)
            }).then(response => response.json());
            
            automationPromise
            .then(async (data) => {
                if (data.success) {
                    post.status = 'completed';
                    await patchPostStatus(post.id, 'completed');
                    addLog(`âœ… ê²Œì‹œë¬¼ ${currentPostIndex + 1} ì™„ë£Œ`);
                } else {
                    post.status = 'failed';
                    await patchPostStatus(post.id, 'failed');
                    addLog(`âŒ ê²Œì‹œë¬¼ ${currentPostIndex + 1} ì‹¤íŒ¨: ${data.error}`);
                }
                
                // ğŸ’¾ ìƒíƒœ ë³€ê²½ í›„ ìë™ ì €ì¥
                savePosts();
                updatePostList();
                currentPostIndex++;
                
                // ë‹¤ìŒ ê²Œì‹œë¬¼ë¡œ ì´ë™ (ë”œë ˆì´ í›„)
                const delay = parseInt(document.getElementById('postDelay').value) * 1000;
                setTimeout(() => {
                    if (isAutomationRunning) {
                        processNextPost();
                    }
                }, delay);
            })
            .catch(error => {
                console.error('ğŸ” [FRONTEND] ìë™í™” ì˜¤ë¥˜ ìƒì„¸:', error);
                console.error('ğŸ” [FRONTEND] ì˜¤ë¥˜ íƒ€ì…:', typeof error);
                console.error('ğŸ” [FRONTEND] ì˜¤ë¥˜ ì´ë¦„:', error.name);
                console.error('ğŸ” [FRONTEND] ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                console.error('ğŸ” [FRONTEND] ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                
                // í´ë¡  ì˜¤ë¥˜ íŠ¹ë³„ ì²˜ë¦¬
                if (error.message && error.message.includes('cloned')) {
                    console.error('ğŸ” [FRONTEND] í´ë¡  ì˜¤ë¥˜ ê°ì§€!');
                    console.error('ğŸ” [FRONTEND] í˜„ì¬ ê²Œì‹œë¬¼ ë°ì´í„°:', post);
                    
                    // ì´ë¯¸ì§€ ë°ì´í„° ìƒì„¸ ë¶„ì„
                    if (post.images && post.images.length > 0) {
                        console.error('ğŸ” [FRONTEND] ì´ë¯¸ì§€ ë°ì´í„° ìƒì„¸ ë¶„ì„:');
                        post.images.forEach((img, idx) => {
                            console.error(`  ì´ë¯¸ì§€ ${idx}:`, {
                                type: typeof img,
                                isFile: img instanceof File,
                                isBlob: img instanceof Blob,
                                isArrayBuffer: img instanceof ArrayBuffer,
                                constructor: img?.constructor?.name,
                                keys: Object.keys(img || {}),
                                hasData: img && 'data' in img,
                                dataType: img?.data ? typeof img.data : 'none',
                                dataLength: img?.data ? img.data.length : 0,
                                dataStartsWith: img?.data ? img.data.substring(0, 50) : 'none'
                            });
                            
                            // ê° ì†ì„±ë³„ ì§ë ¬í™” í…ŒìŠ¤íŠ¸
                            if (img && typeof img === 'object') {
                                Object.keys(img).forEach(key => {
                                    try {
                                        JSON.stringify(img[key]);
                                        console.error(`    âœ… ${key}: ì§ë ¬í™” ê°€ëŠ¥`);
                                    } catch (serErr) {
                                        console.error(`    âŒ ${key}: ì§ë ¬í™” ë¶ˆê°€ëŠ¥`, serErr.message);
                                    }
                                });
                            }
                        });
                    }
                    
                    // ë™ì˜ìƒ ë°ì´í„°ë„ í™•ì¸
                    if (post.videos && post.videos.length > 0) {
                        console.error('ğŸ” [FRONTEND] ë™ì˜ìƒ ë°ì´í„° ìƒì„¸ ë¶„ì„:');
                        post.videos.forEach((vid, idx) => {
                            console.error(`  ë™ì˜ìƒ ${idx}:`, {
                                type: typeof vid,
                                isFile: vid instanceof File,
                                isBlob: vid instanceof Blob,
                                constructor: vid?.constructor?.name,
                                keys: Object.keys(vid || {})
                            });
                        });
                    }
                    
                    // settings ê°ì²´ë„ í™•ì¸
                    console.error('ğŸ” [FRONTEND] settings ê°ì²´ ë¶„ì„:', {
                        type: typeof settings,
                        keys: Object.keys(settings || {}),
                        values: settings
                    });
                }
                
                post.status = 'failed';
                addLog(`âŒ ê²Œì‹œë¬¼ ${currentPostIndex + 1} ì˜¤ë¥˜: ${error.message}`);
                
                // ğŸ’¾ ìƒíƒœ ë³€ê²½ í›„ ìë™ ì €ì¥
                savePosts();
                updatePostList();
                
                currentPostIndex++;
                setTimeout(() => {
                    if (isAutomationRunning) {
                        processNextPost();
                    }
                }, 2000);
            });
        }

        // ìë™í™” ì™„ë£Œ
        function completeAutomation() {
            isAutomationRunning = false;
            
            document.getElementById('startAutomation').disabled = false;
            document.getElementById('stopAutomation').disabled = true;
            
            const completedCount = posts.filter(p => p.status === 'completed').length;
            const failedCount = posts.filter(p => p.status === 'failed').length;
            
            updateProgress(100, `ì™„ë£Œ: ${completedCount}ê°œ, ì‹¤íŒ¨: ${failedCount}ê°œ`);
            showStatus('success', `ìë™í™” ì™„ë£Œ! ì„±ê³µ: ${completedCount}ê°œ, ì‹¤íŒ¨: ${failedCount}ê°œ`);
            addLog(`ğŸ‰ ìë™í™” ì™„ë£Œ - ì„±ê³µ: ${completedCount}ê°œ, ì‹¤íŒ¨: ${failedCount}ê°œ`);
        }

        // ìë™í™” ì¤‘ì§€
        function stopAutomation() {
            isAutomationRunning = false;
            
            document.getElementById('startAutomation').disabled = false;
            document.getElementById('stopAutomation').disabled = true;
            
            showStatus('info', 'ìë™í™”ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            addLog('â¹ï¸ ìë™í™” ì¤‘ì§€ë¨');
        }

        // ì´ˆê¸°í™” (ğŸ’¾ ìƒíƒœ ì €ì¥ í¬í•¨)
        function resetAutomation() {
            const completedCount = posts.filter(post => post.status === 'completed').length;
            
            if (completedCount > 0) {
                const resetAll = confirm(
                    `ì™„ë£Œëœ ê²Œì‹œë¬¼ì´ ${completedCount}ê°œ ìˆìŠµë‹ˆë‹¤.\n\n` +
                    `"í™•ì¸": ëª¨ë“  ê²Œì‹œë¬¼ì„ ëŒ€ê¸° ìƒíƒœë¡œ ì´ˆê¸°í™”\n` +
                    `"ì·¨ì†Œ": ì™„ë£Œëœ ê²Œì‹œë¬¼ì€ ìœ ì§€í•˜ê³  ì‹¤íŒ¨/ì²˜ë¦¬ì¤‘ì¸ ê²Œì‹œë¬¼ë§Œ ì´ˆê¸°í™”`
                );
                
                if (resetAll) {
                    // ëª¨ë“  ê²Œì‹œë¬¼ì„ ëŒ€ê¸° ìƒíƒœë¡œ ì´ˆê¸°í™”
                    posts.forEach(post => post.status = 'pending');
                    addLog('ğŸ”„ ëª¨ë“  ê²Œì‹œë¬¼ì´ ëŒ€ê¸° ìƒíƒœë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ì™„ë£Œëœ ê²Œì‹œë¬¼ì€ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ë§Œ ì´ˆê¸°í™”
                    posts.forEach(post => {
                        if (post.status !== 'completed') {
                            post.status = 'pending';
                        }
                    });
                    addLog(`ğŸ”„ ì™„ë£Œëœ ${completedCount}ê°œ ê²Œì‹œë¬¼ì€ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ë§Œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            } else {
                // ì™„ë£Œëœ ê²Œì‹œë¬¼ì´ ì—†ìœ¼ë©´ ëª¨ë“  ê²Œì‹œë¬¼ ì´ˆê¸°í™”
                posts.forEach(post => post.status = 'pending');
                addLog('ğŸ”„ ëª¨ë“  ê²Œì‹œë¬¼ì´ ëŒ€ê¸° ìƒíƒœë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            
            currentPostIndex = 0;
            
            // ğŸ’¾ ìƒíƒœ ì´ˆê¸°í™” í›„ ì €ì¥
            savePosts();
            
            updatePostList();
            updateProgress(0, 'ìë™í™” ì¤€ë¹„ ì™„ë£Œ');
            clearLogs();
            showStatus('info', 'ìë™í™”ê°€ ì´ˆê¸°í™”ë˜ê³  ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾');
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress(percentage, text) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('statusText').textContent = text;
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message) {
            const logEntries = document.getElementById('logEntries');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logEntries.appendChild(logEntry);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            logEntries.scrollTop = logEntries.scrollHeight;
        }

        // ë¡œê·¸ ì´ˆê¸°í™”
        function clearLogs() {
            document.getElementById('logEntries').innerHTML = '<div class="log-entry">ìë™í™” ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>';
        }

        // ğŸ’¾ ê²Œì‹œë¬¼ ì €ì¥ í•¨ìˆ˜
        function savePosts() {
            try {
                // localStorage.setItem('youtube_posts', JSON.stringify(posts)); // ì‚­ì œ
                console.log('ê²Œì‹œë¬¼ ì €ì¥ ì™„ë£Œ:', posts.length + 'ê°œ');
            } catch (error) {
                console.error('ê²Œì‹œë¬¼ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ê²Œì‹œë¬¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì €ì¥ ê³µê°„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // ğŸ’¾ ê²Œì‹œë¬¼ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ (API ì—°ë™)
        async function loadPosts() {
            try {
                const res = await fetch('/api/posts');
                if (!res.ok) throw new Error('ê²Œì‹œë¬¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                posts = await res.json();
                updatePostList();
                if (posts.length > 0) {
                    showStatus('info', `ì €ì¥ëœ ê²Œì‹œë¬¼ ${posts.length}ê°œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ’¾`);
                }
            } catch (error) {
                console.error('ê²Œì‹œë¬¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                    alert('ê²Œì‹œë¬¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ì•±ì„ ë°˜ë“œì‹œ Electron(ì•„ì´ì½˜ ë”ë¸”í´ë¦­ ë˜ëŠ” npm run electron)ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ë©´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                posts = [];
            }
        }

        // ========================================
        // ğŸ‘¥ ê³„ì • ê´€ë¦¬ í•¨ìˆ˜ë“¤
        // ========================================

        // ğŸ’¾ ê³„ì • ì €ì¥ í•¨ìˆ˜
        function saveAccounts() {
            try {
                localStorage.setItem('youtube_accounts', JSON.stringify(accounts));
                console.log('ê³„ì • ì €ì¥ ì™„ë£Œ:', accounts.length + 'ê°œ');
                updateAccountCount();
            } catch (error) {
                console.error('ê³„ì • ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ê³„ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì €ì¥ ê³µê°„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // ğŸ’¾ ê³„ì • ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        async function loadAccounts() {
            try {
                const res = await fetch('/api/accounts');
                if (!res.ok) throw new Error('ê³„ì • ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                accounts = await res.json();
                updateAccountList();
                updateAccountDropdown();
                updateAccountCount();
            } catch (error) {
                console.error('ê³„ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                    alert('ê³„ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ì•±ì„ ë°˜ë“œì‹œ Electron(ì•„ì´ì½˜ ë”ë¸”í´ë¦­ ë˜ëŠ” npm run electron)ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ë©´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                accounts = [];
            }
        }

        // ê³„ì • ì¶”ê°€ (API ì—°ë™)
        async function addAccount() {
            const name = document.getElementById('accountName').value.trim();
            const username = document.getElementById('accountUsername').value.trim();
            const password = document.getElementById('accountPassword').value.trim();
            const description = document.getElementById('accountDescription').value.trim();
            if (!name || !username || !password) {
                alert('ê³„ì •ëª…, ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            const accountData = { name, username, password, description };
            const result = await addAccountAPI(accountData);
            if (result.success) {
                alert('ê³„ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadAccounts();
                clearAccountForm();
            } else {
                alert('ê³„ì • ì¶”ê°€ ì‹¤íŒ¨');
            }
        }

        // ê³„ì • ìˆ˜ì •
        function editAccount(accountId) {
            const account = accounts.find(acc => acc.id === accountId);
            if (!account) return;

            editingAccountId = accountId;
            
            // í¼ì— ê¸°ì¡´ ë°ì´í„° ì„¤ì •
            document.getElementById('accountName').value = account.name;
            document.getElementById('accountUsername').value = account.username;
            document.getElementById('accountPassword').value = account.password;
            document.getElementById('accountDescription').value = account.description;

            // UI ë³€ê²½
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
            document.querySelector('#accountForm button[onclick="addAccount()"]').textContent = 'ğŸ’¾ ê³„ì • ìˆ˜ì •';

            // ê³„ì • ê´€ë¦¬ íƒ­ìœ¼ë¡œ ì´ë™
            switchTab('accounts');
            
            // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('accountForm').scrollIntoView({ behavior: 'smooth' });
        }

        // ê³„ì • ì‚­ì œ (API ì—°ë™)
        async function deleteAccount(accountId) {
            if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const res = await fetch(`/api/accounts/${accountId}`, { method: 'DELETE' });
            const result = await res.json();
            if (result.success) {
                alert('ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadAccounts();
            } else {
                alert('ê³„ì • ì‚­ì œ ì‹¤íŒ¨');
            }
        }

        // ê³„ì • í¼ ì´ˆê¸°í™”
        function clearAccountForm() {
            document.getElementById('accountForm').reset();
            editingAccountId = null;
            document.getElementById('cancelEditBtn').style.display = 'none';
            document.querySelector('#accountForm button[onclick="addAccount()"]').textContent = 'â• ê³„ì • ì¶”ê°€';
        }

        // ê³„ì • ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateAccountList() {
            const accountList = document.getElementById('accountList');
            
            if (accounts.length === 0) {
                accountList.innerHTML = `
                    <p style="text-align: center; color: #666; font-style: italic;">
                        ì•„ì§ ë“±ë¡ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ìœ„ì—ì„œ ê³„ì •ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                    </p>
                `;
                return;
            }

            accountList.innerHTML = accounts.map(account => `
                <div class="post-item">
                    <div class="post-content">
                        <h4>ğŸ‘¤ ${account.name}</h4>
                        <p><strong>ì•„ì´ë””:</strong> ${account.username}</p>
                        <p><strong>ë¹„ë°€ë²ˆí˜¸:</strong> ${'*'.repeat(account.password.length)}</p>
                        ${account.description ? `<p><strong>ì„¤ëª…:</strong> ${account.description}</p>` : ''}
                        <p style="font-size: 12px; color: #999;">
                            ìƒì„±ì¼: ${new Date(account.createdAt).toLocaleString('ko-KR')}
                        </p>
                    </div>
                    <div class="post-actions">
                        <button class="btn btn-secondary" onclick="editAccount('${account.id}')">
                            âœï¸ ìˆ˜ì •
                        </button>
                        <button class="btn btn-danger" onclick="deleteAccount('${account.id}')">
                            ğŸ—‘ï¸ ì‚­ì œ
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ê³„ì • ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateAccountDropdown() {
            const postAccount = document.getElementById('postAccount');
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
            while (postAccount.children.length > 1) {
                postAccount.removeChild(postAccount.lastChild);
            }
            // ê³„ì • ì˜µì…˜ ì¶”ê°€
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = `${account.name} (${account.username})`;
                postAccount.appendChild(option);
            });
            // updateEditAccountDropdown(); // ë¬´í•œ ì¬ê·€ ë°©ì§€ ìœ„í•´ ì œê±°
        }

        // ê³„ì • ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateAccountCount() {
            const accountCount = document.getElementById('accountCount');
            if (accountCount) {
                accountCount.textContent = `ğŸ’¾ ì €ì¥ëœ ê³„ì •: ${accounts.length}ê°œ`;
            }
        }

        // ğŸ’¾ ëª¨ë“  ê²Œì‹œë¬¼ ì‚­ì œ í•¨ìˆ˜
        function clearAllPosts() {
            if (confirm('ëª¨ë“  ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                posts = [];
                savePosts();
                updatePostList();
                showStatus('success', 'ëª¨ë“  ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾');
            }
        }

        // ğŸ’¾ ê²Œì‹œë¬¼ ë‚´ë³´ë‚´ê¸° (ë°±ì—…)
        function exportPosts() {
            if (posts.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const dataStr = JSON.stringify(posts, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `youtube_posts_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showStatus('success', 'ê²Œì‹œë¬¼ì´ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤! ğŸ’¾');
        }

        // ğŸ’¾ ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸° (ë³µì›)
        function importPosts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedPosts = JSON.parse(e.target.result);
                        
                        if (Array.isArray(importedPosts)) {
                            if (posts.length > 0) {
                                if (confirm('ê¸°ì¡´ ê²Œì‹œë¬¼ì´ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                    posts = importedPosts;
                                } else {
                                    posts = posts.concat(importedPosts);
                                }
                            } else {
                                posts = importedPosts;
                            }
                            
                            savePosts();
                            updatePostList();
                            showStatus('success', `${importedPosts.length}ê°œ ê²Œì‹œë¬¼ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤! ğŸ’¾`);
                        } else {
                            alert('ì˜¬ë°”ë¥¸ ê²Œì‹œë¬¼ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(type, message) {
            const status = document.getElementById('automationStatus');
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (ğŸ’¾ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°)
        document.addEventListener('DOMContentLoaded', function() {
            // Electron í™˜ê²½ì´ ì•„ë‹ˆë©´ ê²½ê³ 
            if (typeof window.electronAPI === 'undefined') {
                alert('ì´ ì•±ì€ ë°˜ë“œì‹œ Electronìœ¼ë¡œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ë©´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            loadAccounts();
            loadPosts();
            
            // ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const savedSettings = localStorage.getItem('automation_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                Object.keys(settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = settings[key];
                        } else {
                            element.value = settings[key];
                        }
                    }
                });
            }
            
            updatePostList();
            
            // ğŸ”Œ Electron í™˜ê²½ì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ ìˆ˜ì‹  ì„¤ì •
            if (typeof window.electronAPI !== 'undefined') {
                console.log('ğŸ“± Electron ì•± í™˜ê²½ ê°ì§€');
                
                // ì‹¤ì‹œê°„ ë¡œê·¸ ìˆ˜ì‹ 
                window.electronAPI.onAutomationLog((logData) => {
                    const { postIndex, message, type } = logData;
                    
                    if (type === 'error') {
                        addLog(`âŒ [ê²Œì‹œë¬¼ ${postIndex + 1}] ${message}`);
                    } else {
                        addLog(`ğŸ“ [ê²Œì‹œë¬¼ ${postIndex + 1}] ${message}`);
                    }
                });
            } else {
                console.log('ğŸŒ ë¸Œë¼ìš°ì € í™˜ê²½ ê°ì§€');
            }
        });

        // ê²Œì‹œë¬¼ ì¶”ê°€ ë²„íŠ¼ ì˜ˆì‹œ (í¼ ì œì¶œ ë“±ì—ì„œ)
        document.addEventListener('DOMContentLoaded', function() {
            var addPostBtn = document.getElementById('addPostBtn');
            if (addPostBtn) {
                addPostBtn.onclick = async function() {
                    const content = document.getElementById('newPostContent').value.trim();
                    const accountId = document.getElementById('postAccount').value;
                    if (!content) {
                        alert('ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                        return;
                    }
                    if (!accountId) {
                        alert('ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”.');
                        return;
                    }
                    await addPost({ content, accountId });
                };
            }
            var accountForm = document.getElementById('accountForm');
            if (accountForm) {
                accountForm.onsubmit = async function(e) {
                    e.preventDefault();
                    if (editingAccountId) {
                        await updateAccount(editingAccountId);
                    } else {
                        await addAccount();
                    }
                };
            }
            var postForm = document.getElementById('postForm');
            if (postForm) {
                postForm.onsubmit = async function(e) {
                    e.preventDefault();
                    if (editingPostId) {
                        await updatePost(editingPostId);
                    } else {
                        const content = document.getElementById('newPostContent').value.trim();
                        const accountId = document.getElementById('postAccount').value;
                        await addPost({ content, accountId });
                    }
                };
            }
            var cancelEditBtn = document.getElementById('cancelEditBtn');
            if (cancelEditBtn) cancelEditBtn.onclick = clearAccountForm;
            // ... ê¸°íƒ€ ë²„íŠ¼ë„ ëª¨ë‘ if (btn) ... í˜•íƒœë¡œë§Œ ì—°ê²°
        });

        // ê²Œì‹œë¬¼ ìˆ˜ì • (API ì—°ë™) - ê³„ì • ì •ë³´ë„ ë°˜ì˜
        async function updatePost(postId) {
            const content = document.getElementById('newPostContent').value.trim();
            const accountId = document.getElementById('postAccount').value;
            if (!content) {
                alert('ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            if (!accountId) {
                alert('ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            const res = await fetch(`/api/posts/${postId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content, accountId })
            });
            const result = await res.json();
            if (result.success) {
                alert('ê²Œì‹œë¬¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadAllAndUpdatePosts();
                cancelEditPost();
            } else {
                alert('ê²Œì‹œë¬¼ ìˆ˜ì • ì‹¤íŒ¨');
            }
        }

        // ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ê°œì„  (ì´ë¯¸ì§€ url, ê³„ì •ëª…, ìƒì„±ì¼, ìƒíƒœ ë“± í‘œì‹œ)
        function updatePostList() {
            const postList = document.getElementById('postList');
            if (!Array.isArray(posts) || posts.length === 0) {
                postList.innerHTML = `<p style="text-align: center; color: #666; font-style: italic;">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ì—ì„œ ê²Œì‹œë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>`;
                return;
            }
            if (!accounts || accounts.length === 0) {
                loadAccounts().then(updatePostList);
                return;
            }
            postList.innerHTML = posts.map((post, idx) => {
                const account = accounts.find(acc => acc.id === post.accountId);
                const accountInfo = account ? `${account.name} (${account.username})` : 'ê³„ì • ì •ë³´ ì—†ìŒ';
                const createdAtText = post.createdAt ? new Date(post.createdAt).toLocaleString('ko-KR') : 'ë‚ ì§œ ì—†ìŒ';
                let statusText = 'ëŒ€ê¸°ì¤‘';
                if (post.status === 'completed') statusText = 'ì™„ë£Œ';
                else if (post.status === 'failed') statusText = 'ì‹¤íŒ¨';
                else if (post.status === 'processing') statusText = 'ì²˜ë¦¬ì¤‘';
                else if (post.status) statusText = post.status;
                // ì´ë¯¸ì§€ í‘œì‹œ (urlë§Œ ì‚¬ìš©)
                let imagesHtml = '';
                if (post.images && post.images.length > 0) {
                    imagesHtml = `<div style='margin-top:4px;'>` + post.images.map(img => `<img src='${img.url}' alt='ì´ë¯¸ì§€' style='width:60px;height:40px;object-fit:cover;margin-right:4px;border-radius:4px;'>`).join('') + `</div>`;
                }
                return `
                    <div class="post-item">
                        <div class="post-content">
                            <h4>${post.content}</h4>
                            <p>ê³„ì •: ${accountInfo}</p>
                            <p>ìƒíƒœ: ${statusText} | ìƒì„±ì¼: ${createdAtText}</p>
                            ${imagesHtml}
                        </div>
                        <div class="post-actions">
                            <button class="btn btn-secondary" onclick="editPost('${post.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger" onclick="deletePost('${post.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë“œ ì§„ì…
        function editPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            openEditPostModal(post);
        }

        // ê²Œì‹œë¬¼ ìˆ˜ì • ì·¨ì†Œ
        function cancelEditPost() {
            editingPostId = null;
            document.getElementById('postForm').reset();
            document.getElementById('addPostBtn').textContent = 'â• ê²Œì‹œë¬¼ ì¶”ê°€';
            document.getElementById('cancelEditPostBtn').style.display = 'none';
        }

        document.getElementById('cancelEditPostBtn').onclick = cancelEditPost;

        document.getElementById('postForm').onsubmit = async function(e) {
            e.preventDefault();
            if (editingPostId) {
                await updatePost(editingPostId);
            } else {
                await addPost({ content: document.getElementById('newPostContent').value.trim() });
            }
        };

        // ê²Œì‹œë¬¼ í•„í„°/ì •ë ¬/ê²€ìƒ‰ í•¨ìˆ˜ (í•­ìƒ ì •ì˜)
        function getFilteredSortedPosts() {
            if (!Array.isArray(posts)) return [];
            let filtered = posts.slice();
            if (typeof postFilter !== 'undefined') {
                if (postFilter.status) filtered = filtered.filter(p => p.status === postFilter.status);
                if (postFilter.dateStart) filtered = filtered.filter(p => p.createdAt && p.createdAt >= postFilter.dateStart);
                if (postFilter.dateEnd) filtered = filtered.filter(p => p.createdAt && p.createdAt <= postFilter.dateEnd + 'T23:59:59');
                if (postFilter.search) filtered = filtered.filter(p => p.content && p.content.includes(postFilter.search));
                filtered.sort((a, b) => {
                    if (postFilter.sort === 'desc') return (b.createdAt || '').localeCompare(a.createdAt || '');
                    else return (a.createdAt || '').localeCompare(b.createdAt || '');
                });
            }
            return filtered;
        }

        // ëª¨ë“  JS ì´ˆê¸°í™” ì½”ë“œëŠ” DOMContentLoaded ì•ˆì—ì„œ ì‹¤í–‰
        // (ì•„ë˜ ì˜ˆì‹œì²˜ëŸ¼ ê¸°ì¡´ ì´ˆê¸°í™” ì½”ë“œ ê°ì‹¸ê¸°)
        document.addEventListener('DOMContentLoaded', function() {
            // ë²„íŠ¼ id ì¡´ì¬ ì‹œì—ë§Œ ì´ë²¤íŠ¸ ì—°ê²°
            var addPostBtn = document.getElementById('addPostBtn');
            if (addPostBtn) {
                addPostBtn.onclick = async function() {
                    const content = document.getElementById('newPostContent').value.trim();
                    const accountId = document.getElementById('postAccount').value;
                    if (!content) {
                        alert('ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                        return;
                    }
                    if (!accountId) {
                        alert('ê³„ì •ì„ ì„ íƒí•˜ì„¸ìš”.');
                        return;
                    }
                    await addPost({ content, accountId });
                };
            }
            // ... ë‚˜ë¨¸ì§€ ì´ˆê¸°í™” ì½”ë“œ (ì´ë²¤íŠ¸ ì—°ê²° ë“±)
        });

        // editPost í•¨ìˆ˜ëŠ” ë°˜ë“œì‹œ ì „ì—­ì— ì •ì˜ë˜ì–´ì•¼ í•¨
        window.editPost = editPost;

        // ì„œë²„ APIë¡œ ê³„ì • ì¶”ê°€ í•¨ìˆ˜ (ë°˜ë“œì‹œ ì •ì˜)
        async function addAccountAPI(accountData) {
            try {
                const res = await fetch('/api/accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(accountData)
                });
                return await res.json();
            } catch (error) {
                alert('ê³„ì • ì¶”ê°€ ì‹¤íŒ¨: ì•±ì„ ë°˜ë“œì‹œ Electron(ì•„ì´ì½˜ ë”ë¸”í´ë¦­ ë˜ëŠ” npm run electron)ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ë©´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return { success: false };
            }
        }

        // (ì„ì‹œ) localStorageì— ë‚¨ì•„ìˆëŠ” ê³„ì • ë°ì´í„° ì™„ì „ ì‚­ì œ
        try { localStorage.removeItem('youtube_accounts'); } catch(e) {}

        // ê²Œì‹œë¬¼ë„ ì„œë²„ APIë¡œë§Œ ë¶ˆëŸ¬ì˜¤ê¸° (localStorage ì½”ë“œ ì™„ì „ ì œê±°)
        async function loadPosts() {
            try {
                const res = await fetch('/api/posts');
                if (!res.ok) throw new Error('ê²Œì‹œë¬¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                posts = await res.json();
                updatePostList();
                if (posts.length > 0) {
                    showStatus('info', `ì €ì¥ëœ ê²Œì‹œë¬¼ ${posts.length}ê°œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ’¾`);
                }
            } catch (error) {
                console.error('ê²Œì‹œë¬¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                posts = [];
            }
        }

        window.addAccount = addAccount;

        // ê²Œì‹œë¬¼ ëª©ë¡ê³¼ ê³„ì • ëª©ë¡ì„ ëª¨ë‘ ë¶ˆëŸ¬ì˜¨ ë’¤ ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
        async function loadAllAndUpdatePosts() {
            await loadAccounts();
            await loadPosts();
            updatePostList();
        }

        // ê²Œì‹œë¬¼ ìƒíƒœë§Œ PATCHë¡œ ì„œë²„ì— ì €ì¥
        async function patchPostStatus(postId, status) {
            try {
                const res = await fetch(`/api/posts/${postId}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });
                return await res.json();
            } catch (error) {
                console.error('ê²Œì‹œë¬¼ ìƒíƒœ PATCH ì‹¤íŒ¨:', error);
                return { success: false };
            }
        }
    </script>
</body>
</html> 